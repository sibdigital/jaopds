<mat-vertical-stepper [linear]="isLinear" #stepper>
  <mat-step [stepControl]="zeroFormGroup">
    <form [formGroup]="zeroFormGroup">
      <ng-template matStepLabel>Загрузите файл</ng-template>
      <div style="padding-bottom: 20px">
        <button mat-raised-button type="button" (click)="fileInput.click()">
          Выберите файл
          <input #fileInput type="file" style="display: none" [accept]="'*.*'" [multiple]="false" (change)="filesChanged($event)"/>
        </button>
        <span class="file-input-text" style="padding-left: 25px">{{ selectedFileText }}</span>
      </div>
      <div>
        <button
          mat-raised-button matStepperNext type="button" color = "primary" class="file-input-button" (click) = "startProcessFile()">
          Начать загрузку
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="firstFormGroup">
    <form [formGroup]="firstFormGroup">
      <ng-template matStepLabel>Сопоставление загружаемого результата и мероприятия из ИСУПа</ng-template>
      <div>
        <mat-radio-group class="radio-group" *ngIf="!workPackageIsMatched">
          <mat-radio-button class="radio-button" value="1" (change)="projectRadioChange($event)" [checked]="selectProjectVisible">Выбрать существующий проект</mat-radio-button>
          <mat-radio-button class="radio-button" value="2" (change)="projectRadioChange($event)">Создать новый проект</mat-radio-button>
        </mat-radio-group>
        <app-project-select [selectedProject]="selectedProject" (outputSelectedProject)="getOutputProject($event)" #projectSelectComponent [hidden]="!selectProjectVisible"></app-project-select>
        <mat-form-field *ngIf="!selectProjectVisible" class="project-width">
          <mat-label>Название нового проекта</mat-label>
          <input matInput (change)="setNewProjectName($event.target)">
        </mat-form-field>
      </div>
      <div>
        <mat-radio-group class="radio-group"  *ngIf="workPackageMatRadioGroupVisible && !workPackageIsMatched">
          <mat-radio-button class="radio-button" value="1" (change)="workPackageRadioChange($event)" [checked]="selectWorkPackageVisible">Выбрать существующее мероприятие</mat-radio-button>
          <mat-radio-button class="radio-button" value="2" (change)="workPackageRadioChange($event)" [checked]="!selectWorkPackageVisible">Создать новое мероприятие</mat-radio-button>
        </mat-radio-group>
        <app-work-package-select [selectedWorkPackage]="selectedWorkPackage" [hidden]="!selectWorkPackageVisible" #workPackageSelectComponent (outputSelectedWorkPackage)="getOutputWorkPackage($event)"></app-work-package-select>
        <mat-form-field *ngIf="!selectWorkPackageVisible" class="project-width">
          <mat-label>Название результата</mat-label>
          <input matInput (change)="setNewWorkPackageName($event.target)">
        </mat-form-field>
      </div>
      <div style="padding-top: 20px">
        <button *ngFor="!workPackageIsMatched"
          mat-raised-button type="button" color = "primary" (click) = "selectOrCreateWorkPackage()">
          Продолжить
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step>
    <form [formGroup]="secondFormGroup">
      <ng-template matStepLabel>Загрузка финансового обеспечения</ng-template>
      <mat-spinner *ngIf="secondSpinnerVisible" [diameter]="30"></mat-spinner>
      <span>{{ financeResultText }}</span>
    </form >
  </mat-step>
  <mat-step>
    <form [formGroup]="thirdFormGroup">
      <ng-template matStepLabel>Загрузка целевых показателей</ng-template>
      <mat-spinner *ngIf="thirdSpinnerVisible" [diameter]="30"></mat-spinner>

      <table mat-table *ngIf="targetTableVisible" class="mat-elevation-z8" #targetMatchTable [dataSource] = targetMatches>
        <ng-container matColumnDef="el-budget">
          <th mat-header-cell *matHeaderCellDef>Электронный бюджет</th>
            <td mat-cell *matCellDef="let targetMatch">
              <app-purpose-criteria-view [purposeCriteria]="targetMatch.purposeCriteria"></app-purpose-criteria-view>
            </td>
        </ng-container>

        <ng-container matColumnDef="opsd">
          <th mat-header-cell *matHeaderCellDef>ИСУП</th>
          <td mat-cell *matCellDef="let targetMatch">
            <app-target-select [targets]="targetsByProject" [selectedTarget]="targetMatch.target" (outputSelectedTarget)="getOutputTarget($event, targetMatch)" target-select></app-target-select>
          </td>
        </ng-container>
        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
        <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
      </table>
      <div style="padding-top: 20px">
        <button
          mat-raised-button *ngIf="processTargetBtnVisible" type="button" color = "primary" (click) = "continueProcessTarget()">
          Продолжить загрузку
        </button>
      </div>
      <div style="padding-top: 20px">
        <span>{{ targetResultText }}</span>
      </div>
    </form>
  </mat-step>
</mat-vertical-stepper>
